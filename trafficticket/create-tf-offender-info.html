<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    สร้างใบสั่ง
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <!-- CSS Files -->
  <link href="assets/css/material-dashboard.css?v=2.1.0" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="assets/demo/demo.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script>
    var urlParams = new URLSearchParams(window.location.search);
    var username = urlParams.get('username');
    var unitNo = urlParams.get('unitno');
    var reporter = urlParams.get('reporter');

    $(function () {
      $("#header").load("header.html");
    });

    $(function () {
      $("#nev").load("nev.html");
    });

    if (typeof web3 !== 'undefined') {

      web3 = new Web3(web3.currentProvider);
      console.log("existing web3: provider " + web3);
      web3.eth.defaultAccount = web3.eth.accounts[0];
    }

    else {

      web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/g5rWkSjjhx1LPmDch30E"));
      console.log("new provider " + typeof web3);

    }

    console.log(web3.isConnected());

    if (web3.isConnected()) {

      var TrafficConstract = web3.eth.contract([{ "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }], "name": "destroyTrafficTicket", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "new_conv_personNo", "type": "string" }, { "name": "new_conv_na", "type": "string" }, { "name": "new_conv_tel", "type": "string" }, { "name": "new_conv_addr", "type": "string" }], "name": "editConvey", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "new_charge", "type": "string" }, { "name": "new_placeOfIncident", "type": "string" }, { "name": "new_speedDetection", "type": "string" }, { "name": "new_amountOfFine", "type": "uint256" }], "name": "editReportCase", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "new_re_name", "type": "string" }, { "name": "new_re_unit", "type": "string" }], "name": "editReporter", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "reporterPoint", "type": "uint256" }, { "name": "reportcasePoint", "type": "uint256" }, { "name": "conveyPoint", "type": "uint256" }, { "name": "trafficID", "type": "string" }], "name": "newTrafficTicket", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "conv_persNo", "type": "string" }, { "name": "_plate", "type": "string" }, { "name": "conv_na", "type": "string" }, { "name": "conv_tel", "type": "string" }, { "name": "conv_addr", "type": "string" }], "name": "setConveyanceOwner", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "charge", "type": "string" }, { "name": "placeOfIncident", "type": "string" }, { "name": "speedDetection", "type": "string" }, { "name": "amountOfFine", "type": "uint256" }], "name": "setReport_case", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "re_name", "type": "string" }, { "name": "re_unit", "type": "string" }], "name": "setReporter", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "_personalid", "type": "string" }], "name": "getConveyance", "outputs": [{ "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }], "name": "getConveyancePoint", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "_personalid", "type": "string" }], "name": "getReportCase", "outputs": [{ "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }], "name": "getReportcasePoint", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "id", "type": "string" }, { "name": "_personalid", "type": "string" }], "name": "getReporter", "outputs": [{ "name": "", "type": "string" }, { "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }], "name": "getReporterPoint", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "ticketNo", "type": "string" }], "name": "getTicket", "outputs": [{ "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "unitNo", "type": "string" }, { "name": "num", "type": "uint256" }], "name": "getTicketNo", "outputs": [{ "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getTotalTicket", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "report_unit", "type": "string" }], "name": "getTotalTicketByUnit", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }]);
      var ticketAddr = "0x512a7b96b3f602a7f334249234895e0f426642c4";
      var traffic = TrafficConstract.at(ticketAddr);

    } else {
      console.log('not connect');
    }

  </script>
</head>

<body class="">
  <div class="wrapper ">
    <div id="nev"></div>
    <div class="main-panel">
      <!-- Navbar -->
      <div id='header'></div>
      <!-- End Navbar -->
      <div class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header card-header-info">
                  <h4 class="card-title">สร้างใบสั่ง</h4>
                  <p class="card-category" style="color:white">ข้อมูลความผิด</p>
                </div>
                <div class="card-body">
                  <form>
                    <div class="row">
                      <div class="col-md-0.7">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">ข้อหา : </font>
                          </label>

                        </div>
                      </div>
                      <div class="col-md-11">
                        <div class="form-group">

                          <input type="text" class="form-control" id="chargeInfo" required>
                        </div>
                      </div>
                      <div class="col-md-1.4">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">สถานที่เกิดเหตุ : </font>
                          </label>

                        </div>
                      </div>
                      <div class="col-md-10">
                        <div class="form-group">
                          <input type="text" class="form-control" id="placeOfIncident" required>
                        </div>
                      </div>
                      <div class="col-md-2.1">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">ความเร็วที่ตรวจจับได้ : </font>
                          </label>

                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">

                          <input type="text" class="form-control" id="speedDetection" required>
                        </div>
                      </div>
                      <div class="col-md-2.1">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">กิโลเมตร/ชั่วโมง</font>
                          </label>

                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-1.3">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">จำนวนค่าปรับ : </font>
                          </label>

                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">

                          <input type="text" class="form-control" id="fineTotal" required>
                        </div>
                      </div>
                      <div class="col-md-2.1">
                        <div class="form-group">
                          <label class="bmd-label-floating">
                            <font size="4">บาท</font>
                          </label>

                        </div>
                      </div>

                    </div>
                   <button type="button" onclick="submitOffender()" class="btn btn-info pull-right">ถัดไป</button>
                    <button type="button" class="btn btn-info pull-right">ย้อนกลับ</button>
                    <div class="clearfix"></div>
                  </form>
                </div>
              </div>
            </div>



          </div>
        </div>
        <!--   Core JS Files   -->
        <script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
        <script src="assets/js/core/popper.min.js" type="text/javascript"></script>
        <script src="assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
        <script src="assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>

        <!-- Chartist JS -->
        <script src="assets/js/plugins/chartist.min.js"></script>
        <!--  Notifications Plugin    -->
        <script src="assets/js/plugins/bootstrap-notify.js"></script>
        <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
        <script src="assets/js/material-dashboard.min.js?v=2.1.0" type="text/javascript"></script>
        <!-- Material Dashboard DEMO methods, don't include it in your project! -->
        <script src="assets/demo/demo.js"></script>

        <script>
          submitOffender = () => {
            traffic.setReport_case.sendTransaction(
              unitNo
              , document.getElementById("chargeInfo").textContent
              , document.getElementById("placeOfIncident").textContent
              , document.getElementById("speedDetection").textContent
              , parseInt(document.getElementById("fineTotal").textContent)
              , function (error, result) {
                if (!error) {

                  traffic.getReportcasePoint(unitNo, (error, res) => {
                    if (!error) {
                      let offenderNo = parseInt(res.c[0]) + 1;
                      window.location.replace("./create-tf-carnumref-info.html?username=" + username + "&unitno=" + unitNo + "&reporter=" + reporter + "&offenderNo=" + offenderNo);
           
                    }
                  })

                   }
                else {
                  alert("Insert data");
                }
              });
          }

        </script>
</body>

</html>